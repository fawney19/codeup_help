import{B as E,r as f,k as V,z as w,i as $,u as H,c as x,a as P,b as v,g as I,m as T,t as M,C as O,h as Q,j as R,D as S}from"./index-DkEg5kBp.js";const ie=E("projects",()=>{const a=f([]),u=f(null),s=f([]),n=f({total:0,authorized:0}),o=f(!1),i=f({page:1,per_page:20,total:0,total_pages:0}),d=f(""),g=f(1),m=f(!1),p=f(!1),y=V(()=>!a.value||!Array.isArray(a.value)?[]:[...a.value].sort((t,c)=>{const e=new Date(t.last_activity_at||0);return new Date(c.last_activity_at||0)-e})),C=(t="")=>{const c=y.value;return t.trim()?c.filter(e=>{const r=(e.name||e.path||"").toLowerCase(),l=(e.description||"").toLowerCase(),b=t.toLowerCase();return r.includes(b)||l.includes(b)}):c},j=(t="")=>m.value?d.value===t:!1,_=(t="",c=1)=>p.value?d.value===t&&g.value===c:!1,h=async(t={},c=!1)=>{const e=t.search||"";if(!c&&j(e))return{success:!0,data:n.value};try{o.value=!0;const r=await w.getStats(t);return r.status==="success"?(n.value=r.data,m.value=!0,d.value=e,{success:!0,data:r.data}):{success:!1,error:r.message}}catch(r){return console.error("Fetch stats failed:",r),{success:!1,error:r.response?.data?.message||"获取统计失败"}}finally{o.value=!1}},F=async(t={},c=!1)=>{const e=t.search||"",r=t.page||1;if(!c&&_(e,r))return{success:!0,data:{projects:a.value,pagination:i.value}};try{o.value=!0;const l=await w.getProjects(t);return l.status==="success"?(a.value=l.data.projects||[],i.value=l.data.pagination||i.value,p.value=!0,d.value=e,g.value=r,{success:!0,data:l.data}):{success:!1,error:l.message}}catch(l){return console.error("Fetch projects failed:",l),{success:!1,error:l.response?.data?.message||"获取项目列表失败"}}finally{o.value=!1}},B=async(t,c={})=>{try{o.value=!0;const e=await w.getProjectOverview(t,c);return e.status==="success"?(u.value=e.data,{success:!0,data:e.data}):{success:!1,error:e.message}}catch(e){return console.error("Fetch project overview failed:",e),{success:!1,error:e.response?.data?.message||"获取项目详情失败"}}finally{o.value=!1}},N=async(t,c={})=>{try{o.value=!0;const e=await w.getProjectActivities(t,c);if(e.status==="success"){const r=(e.data.activities||[]).map(A);return s.value=r,{success:!0,data:e.data}}return{success:!1,error:e.message}}catch(e){return console.error("Fetch activities failed:",e),{success:!1,error:e.response?.data?.message||"获取活动记录失败"}}finally{o.value=!1}},z=async(t,c={})=>{try{o.value=!0;const e=await w.getTodayActivities(t,c);if(e.status==="success"){const r=(e.data.activities||[]).map(A);return s.value=r,{success:!0,data:e.data}}return{success:!1,error:e.message}}catch(e){return console.error("Fetch today activities failed:",e),{success:!1,error:e.response?.data?.message||"获取今日活动失败"}}finally{o.value=!1}},A=t=>{const c=l=>{switch(l){case 5:return"Push";case 1:return"Created";case 2:return"Updated";default:return"Activity"}},e=l=>!l||!l[":commits"]?[]:l[":commits"].map(b=>({id:b[":id"],message:b[":message"],author:b[":author"]})),r=l=>!l||!l[":ref"]?"master":l[":ref"].replace("refs/heads/","");return{...t,created_at:t.createdAt,action:c(t.action),ref_name:r(t.dataMap),target_title:r(t.dataMap),commits:e(t.dataMap),author_name:t.user?.name||t.user?.memberName}};return{projects:a,sortedProjects:y,getFilteredProjects:C,currentProject:u,activities:s,stats:n,loading:o,pagination:i,fetchStats:h,fetchProjects:F,fetchProjectOverview:B,fetchActivities:N,fetchTodayActivities:z,fetchWeekActivities:async(t,c={})=>{try{o.value=!0;const e=await w.getWeekActivities(t,c);if(e.status==="success"){const r=(e.data.activities||[]).map(A);return s.value=r,{success:!0,data:e.data}}return{success:!1,error:e.message}}catch(e){return console.error("Fetch week activities failed:",e),{success:!1,error:e.response?.data?.message||"获取本周活动失败"}}finally{o.value=!1}},fetchMonthActivities:async(t,c={})=>{try{o.value=!0;const e=await w.getMonthActivities(t,c);if(e.status==="success"){const r=(e.data.activities||[]).map(A);return s.value=r,{success:!0,data:e.data}}return{success:!1,error:e.message}}catch(e){return console.error("Fetch month activities failed:",e),{success:!1,error:e.response?.data?.message||"获取本月活动失败"}}finally{o.value=!1}},setCurrentProject:t=>{u.value=t},clearData:()=>{a.value=[],u.value=null,s.value=[],n.value={total:0,authorized:0},i.value={page:1,per_page:20,total:0,total_pages:0},m.value=!1,p.value=!1,d.value="",g.value=1}}}),Z={class:"relative"},q={class:"bg-brutal-cyan border-4 border-blue-600 shadow-brutal p-2 hover:transform hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all"},G={key:0,class:"h-8 w-8 overflow-hidden"},J=["src","alt"],X={key:1,class:"h-8 w-8 flex items-center justify-center"},Y={class:"text-blue-600 font-black text-lg uppercase"},K={class:"bg-brutal-yellow p-4 border-b-4 border-blue-600"},W={class:"font-black text-gray-800 text-lg uppercase truncate"},ee={class:"font-bold text-gray-600 text-sm truncate"},de={__name:"UserAvatar",setup(a){const u=$(),s=H(),n=f(!1),o=f(!1);let i=null;const d=()=>s.user?s.user.name&&s.user.name!==s.user.email?s.user.name:s.user.email?s.user.email.split("@")[0]:"未知用户":"未知用户",g=()=>{const _=d();if(_==="未知用户")return"?";const h=_.trim().split(/\s+/);return h.length>=2?(h[0][0]+h[1][0]).toUpperCase():_[0].toUpperCase()},m=()=>{i&&(clearTimeout(i),i=null),n.value=!0},p=()=>{i=setTimeout(()=>{n.value=!1},100)},y=()=>{i&&(clearTimeout(i),i=null)},C=()=>{n.value=!1},j=async()=>{n.value=!1,s.logout(),await u.push("/login")};return(_,h)=>(P(),x("div",Z,[v("div",{onMouseenter:m,onMouseleave:p,class:"cursor-pointer"},[v("div",q,[T(s).user?.avatar_url?(P(),x("div",G,[v("img",{src:T(s).user.avatar_url,alt:d(),class:"h-8 w-8 object-cover",onError:h[0]||(h[0]=F=>o.value=!0)},null,40,J)])):(P(),x("div",X,[v("span",Y,M(g()),1)]))])],32),I(v("div",{onMouseenter:y,onMouseleave:C,class:R(["absolute right-0 z-10 mt-2 w-64 bg-white border-4 border-blue-600 shadow-brutal-lg transform transition-all duration-200",n.value?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"])},[v("div",K,[v("div",W,M(d()),1),v("div",ee,M(T(s).user?.email||"未设置邮箱"),1)]),v("div",{class:"p-2"},[v("button",{onClick:j,class:"w-full bg-brutal-red border-4 border-blue-600 shadow-brutal-sm p-3 font-black text-gray-800 uppercase text-sm hover:transform hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all flex items-center justify-center"},[...h[1]||(h[1]=[v("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),Q(" 退出登录 ",-1)])])])],34),[[O,n.value]])]))}};/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),te=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(u,s,n)=>n?n.toUpperCase():s.toLowerCase()),se=a=>{const u=te(a);return u.charAt(0).toUpperCase()+u.slice(1)},ae=(...a)=>a.filter((u,s,n)=>!!u&&u.trim()!==""&&n.indexOf(u)===s).join(" ").trim(),D=a=>a==="";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var k={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=({name:a,iconNode:u,absoluteStrokeWidth:s,"absolute-stroke-width":n,strokeWidth:o,"stroke-width":i,size:d=k.width,color:g=k.stroke,...m},{slots:p})=>S("svg",{...k,...m,width:d,height:d,stroke:g,"stroke-width":D(s)||D(n)||s===!0||n===!0?Number(o||i||k["stroke-width"])*24/Number(d):o||i||k["stroke-width"],class:ae("lucide",m.class,...a?[`lucide-${L(se(a))}-icon`,`lucide-${L(a)}`]:["lucide-icon"])},[...u.map(y=>S(...y)),...p.default?[p.default()]:[]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=(a,u)=>(s,{slots:n,attrs:o})=>S(re,{...o,...s,iconNode:u,name:a},n);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=U("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=U("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);export{ve as A,fe as C,de as _,U as c,ie as u};
